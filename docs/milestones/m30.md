# M30 â€” Design System & UI Architecture (Step-by-Step Implementation)

> **Goal**: Build the complete, dual-theme visual identity for YoTop10 before developing complex user-facing pages. This includes the CSS architecture, layout wrappers, typography, the Theme Engine (Futuristic vs Retro Newspaper), and the core component library. By the end of M30, all pages will inherit from a mathematically precise design system.

---

## Architecture Overview

```
frontend/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx             â† Global layout wrapper & Theme Provider
â”‚   â”œâ”€â”€ globals.css            â† Fluid typography, CSS variables, base styles
â”‚   â””â”€â”€ (routes)/              â† All pages ultra-airy, single-column
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ Topbar.tsx         â† Logo, Search, Mobile Hamburger trigger
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx        â† Desktop left navigation
â”‚   â”‚   â””â”€â”€ MobileNav.tsx      â† Slide-out drawer
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                    â† The Core Foundation
â”‚   â”‚   â”œâ”€â”€ Button.tsx         â† Pill-shaped (Futuristic) vs Boxy (Retro)
â”‚   â”‚   â”œâ”€â”€ Card.tsx           â† Floating/Shadow (Futuristic) vs Border (Retro)
â”‚   â”‚   â”œâ”€â”€ VerdictMeter.tsx   â† Lab temperature bar style
â”‚   â”‚   â””â”€â”€ AnimatedIcons.tsx  â† ğŸ”¥ Fire (particle effect), âš¡ Challenge
â”‚   â”‚
â”‚   â””â”€â”€ theme/                 
â”‚       â””â”€â”€ ThemeSwitcher.tsx  â† Context toggle for Futuristic <-> Retro
â”‚
â””â”€â”€ lib/                       
    â””â”€â”€ theme-context.tsx      â† React Context to manage active theme globally
```

---

## ğŸ’» Step 1 â€” Local: Install Design Dependencies

We need specific packages to handle the dual-theme switching, icons, and micro-animations flawlessly. On your local machine:

```bash
cd /home/nekwasar/yotop10/frontend

# For theme switching, class merging, and micro-animations
pnpm add next-themes clsx tailwind-merge framer-motion lucide-react canvas-confetti
pnpm add -D @types/canvas-confetti
```

---

## ğŸ’» Step 2 â€” Typography & Next.js Head Setup

YoTop10 uses 4 specific fonts to define its hierarchy.
- **Monoton** â€” "Yo" in logo
- **Anton** â€” "Top10" in logo
- **Roboto** â€” Ultra-readable body text
- **Cascadia Mono** â€” Labels, metadata, technical elements

Update `frontend/src/app/layout.tsx` to load these fonts locally via `next/font/google` to guarantee 0 cumulative layout shift:

```typescript
import type { Metadata } from "next";
import { Roboto, Monoton, Anton } from "next/font/google";
import localFont from "next/font/local";
import { ThemeProvider } from "@/lib/theme-context";
import "./globals.css";
import AuthProvider from "@/components/auth-provider";

// Note: Cascadia Mono needs to be downloaded as a local font file (.woff2)
// and placed in frontend/public/fonts/CascadiaMono.woff2

const roboto = Roboto({
  weight: ["300", "400", "500", "700"],
  subsets: ["latin"],
  variable: "--font-body",
});

const monoton = Monoton({
  weight: "400",
  subsets: ["latin"],
  variable: "--font-logo-yo",
});

const anton = Anton({
  weight: "400",
  subsets: ["latin"],
  variable: "--font-logo-top10",
});

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    // suppressHydrationWarning is required by next-themes
    <html lang="en" suppressHydrationWarning>
      <body className={`${roboto.variable} ${monoton.variable} ${anton.variable} font-body bg-bg-base text-text-primary antialiased`}>
        <ThemeProvider>
          <AuthProvider>
            <div className="flex h-screen overflow-hidden">
              <Sidebar />
              <div className="relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden">
                <Topbar />
                {/* Ultra-airy single column constraint */}
                <main className="w-full max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
                  {children}
                </main>
              </div>
            </div>
          </AuthProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}
```

---

## ğŸ’» Step 3 â€” The Global CSS Engine (`globals.css`)

This is the brain of the design system. We use raw CSS variables swapped via data-attributes to instantly transition between the **Futuristic** and **Retro** themes without any JavaScript lag.

Rewrite `frontend/src/app/globals.css`:

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ==========================================================
       THEME A: FUTURISTIC (Light Mode)
       ========================================================== */
    --bg-base: #F8F9FA;         /* Off-white paper color */
    --bg-surface: #FFFFFF;
    --text-primary: #0A0A0A;
    --text-muted: #6B7280;
    
    --brand-primary: #FF4500;   /* Orange-Red Neon */
    --brand-secondary: #FF0080; /* Hot Pink */
    
    --radius-ui: 9999px;        /* Pill-shaped */
    --card-shadow: 0 10px 40px -10px rgba(0,0,0,0.08);
    --border-accent: transparent;
    --transition-speed: 0s;     /* Flash quick */
  }

  [data-theme="dark"] {
    /* ==========================================================
       THEME A: FUTURISTIC (Dark Mode)
       ========================================================== */
    --bg-base: #050B14;         /* Extremely dark blue/black */
    --bg-surface: #0A1120;
    --text-primary: #FFFFFF;
    --text-muted: #9CA3AF;
    
    --card-shadow: 0 0 30px rgba(255, 69, 0, 0.05); /* Subtle ambient glow */
    --border-accent: rgba(255, 69, 0, 0.1);
  }

  [data-theme="retro"] {
    /* ==========================================================
       THEME B: RETRO NEWSPAPER (Overrides dark/light)
       ========================================================== */
    --bg-base: #EFECE6;         /* Sepia/Dirty Newspaper white */
    --bg-surface: #FFFFFF;
    --text-primary: #111111;
    --text-muted: #444444;
    
    --brand-primary: #CC0000;   /* Classic harsh red */
    --brand-secondary: #000000;
    
    --radius-ui: 0px;           /* Brutalist, sharp */
    --card-shadow: none;        /* Flat */
    --border-accent: #000000;   /* Harsh visible borders */
    
    /* Force typography override */
    --font-body: 'Times New Roman', Times, serif !important;
  }
}

/* Base element styling tied strictly to variables */
body {
  background-color: var(--bg-base);
  color: var(--text-primary);
  /* Ensures immediate, lag-free transitions */
  transition: background-color var(--transition-speed), color var(--transition-speed);
}

a {
  text-decoration: underline;
  text-underline-offset: 4px;
  text-decoration-color: var(--brand-secondary);
}

a:hover {
  text-decoration-color: var(--brand-primary);
}
```

---

## ğŸ’» Step 4 â€” Implement Dual Navigation

Create the layout components.

**`frontend/src/components/layout/Sidebar.tsx` (Desktop Left Nav)**
```tsx
export default function Sidebar() {
  return (
    <aside className="hidden lg:flex flex-col w-64 h-full border-r border-(--border-accent) bg-[var(--bg-surface)] p-6">
      <div className="flex items-center gap-1 mb-10">
        <span className="font-logo-yo text-3xl text-[var(--brand-primary)]">Yo</span>
        <span className="font-logo-top10 text-3xl text-[var(--text-primary)]">TOP10</span>
      </div>
      
      <nav className="flex flex-col gap-6">
        <NavLink href="/" icon="Home">Public Feed</NavLink>
        <NavLink href="/private" icon="Users">Connections</NavLink>
        <NavLink href="/hot" icon="Flame">Hot Takes</NavLink>
        <NavLink href="/communities" icon="Globe">Communities</NavLink>
      </nav>
      
      <div className="mt-auto">
        <ThemeToggle />
      </div>
    </aside>
  );
}
```

**`frontend/src/components/layout/Topbar.tsx` (Top Nav & Mobile)**
```tsx
export default function Topbar() {
  return (
    <header className="sticky top-0 z-50 w-full h-16 flex items-center justify-between px-4 sm:px-6 lg:px-8 border-b border-(--border-accent) bg-[var(--bg-surface)]/80 backdrop-blur-md">
      {/* Search Input Centered */}
      <div className="flex-1 max-w-xl mx-auto">
        <input 
           type="text" 
           placeholder="Search debates, lists, users..." 
           className="w-full bg-[var(--bg-base)] rounded-[var(--radius-ui)] px-4 py-2 border border-(--border-accent) focus:border-[var(--brand-primary)] outline-none"
        />
      </div>

      {/* Mobile Hamburger (Hidden on Desktop) */}
      <div className="lg:hidden ml-4">
        <button className="p-2" aria-label="Open Menu">
          {/* Hamburger Icon */}
        </button>
      </div>
    </header>
  );
}
```

---

## ğŸ’» Step 5 â€” Core UI Component Library

### The Post Card (`frontend/src/components/ui/Card.tsx`)
```tsx
export function PostCard({ children, imageUrl }: { children: ReactNode, imageUrl?: string }) {
  return (
    <article className="
      relative overflow-hidden group 
      bg-[var(--bg-surface)] 
      rounded-[var(--radius-ui)] 
      shadow-[var(--card-shadow)] 
      border border-(--border-accent)
      p-6 mb-8
    ">
      {/* Neon border hover effect (Futuristic mode only) */}
      <div className="absolute inset-0 border-2 border-[var(--brand-secondary)] opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-[var(--radius-ui)] pointer-events-none" />
      
      {imageUrl && (
        <div className="w-full h-48 overflow-hidden rounded-[calc(var(--radius-ui)-8px)] mb-4">
          <img 
            src={imageUrl} 
            className="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"
            alt="Card hero"
          />
        </div>
      )}
      
      {children}
    </article>
  );
}
```

### The Fire Reaction Button (`frontend/src/components/ui/FireButton.tsx`)
```tsx
"use client"
import confetti from 'canvas-confetti';
import { useState } from 'react';

export function FireButton({ count }: { count: number }) {
  const [active, setActive] = useState(false);

  const triggerSparks = (e: React.MouseEvent) => {
    setActive(true);
    const rect = (e.target as HTMLElement).getBoundingClientRect();
    const x = (rect.left + rect.width / 2) / window.innerWidth;
    const y = (rect.top + rect.height / 2) / window.innerHeight;

    confetti({
      particleCount: 15,
      spread: 40,
      origin: { x, y },
      colors: ['#FF4500', '#FF0080', '#FFA500'],
      ticks: 50, // fast decay
      gravity: 2
    });
  };

  return (
    <button 
      onClick={triggerSparks}
      className={`
        flex items-center gap-2 px-3 py-1.5 
        rounded-[var(--radius-ui)] font-mono text-sm
        ${active ? 'text-[var(--brand-primary)] bg-[var(--brand-primary)]/10' : 'text-[var(--text-muted)] hover:bg-[var(--bg-base)]'}
      `}
    >
      <span className="text-lg">ğŸ”¥</span> 
      <span>{count + (active ? 1 : 0)}</span>
    </button>
  );
}
```

### The Verdict Meter (`frontend/src/components/ui/VerdictMeter.tsx`)
Lab temperature bar visualization for list consensus.
```tsx
export function VerdictMeter({ stats }: { stats: { debunked: number, contested: number, hotTake: number, confirmed: number } }) {
  const total = stats.debunked + stats.contested + stats.hotTake + stats.confirmed;
  
  return (
    <div className="w-full mt-4">
      <div className="flex justify-between text-xs font-mono text-[var(--text-muted)] mb-1">
        <span>VERDICT: CONTESTED</span>
        <span>{total} votes</span>
      </div>
      {/* The Temperature Bar */}
      <div className="h-2 w-full flex rounded-full overflow-hidden bg-[var(--bg-base)] ring-1 ring-inset ring-black/10">
        <div style={{ width: `${(stats.debunked/total)*100}%` }} className="bg-blue-500" />
        <div style={{ width: `${(stats.contested/total)*100}%` }} className="bg-yellow-400" />
        <div style={{ width: `${(stats.hotTake/total)*100}%` }} className="bg-[var(--brand-primary)]" />
        <div style={{ width: `${(stats.confirmed/total)*100}%` }} className="bg-green-500" />
      </div>
    </div>
  );
}
```

### Modals & Overlays (`frontend/src/components/ui/Modal.tsx`)
Because sidebars and topbars are fixed, Modals must use `z-[100]` to explicitly render over everything.
```tsx
export function Modal({ isOpen, onClose, title, children }: ModalProps) {
  if (!isOpen) return null;
  
  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6">
      {/* Glassmorphism Backdrop Overlay */}
      <div 
        className="absolute inset-0 bg-black/40 backdrop-blur-sm"
        onClick={onClose} /* Strict requirement: outside click closes */
      />
      
      {/* Modal Content */}
      <div className="relative w-full max-w-lg bg-[var(--bg-surface)] rounded-[var(--radius-ui)] p-6 shadow-2xl border border-(--border-accent)">
        <h2 className="text-xl font-bold font-body mb-4">{title}</h2>
        {children}
      </div>
    </div>
  );
}
```

### Forms & Text Inputs (`frontend/src/components/ui/Input.tsx`)
Futuristic inputs should visually detach from the background when focused.
```tsx
export function NeonInput(props: React.InputHTMLAttributes<HTMLInputElement>) {
  return (
    <input 
      {...props}
      className="
        w-full px-4 py-3 bg-[var(--bg-base)] text-[var(--text-primary)]
        border border-(--border-accent) rounded-[calc(var(--radius-ui)/2)]
        transition-all duration-200 outline-none
        focus:border-[var(--brand-primary)] focus:shadow-[0_0_15px_rgba(255,69,0,0.2)]
        placeholder-[var(--text-muted)]
      "
    />
  );
}
```

### Toast Notifications (`frontend/src/components/ui/Toast.tsx`)
Crucial for feedback (e.g. "Draft Saved", "Link Copied"). Slides down from the top center for maximum visibility.
```tsx
export function Toast({ message, type = "success" }: { message: string, type?: "success" | "error" }) {
  return (
    <div className="fixed top-20 left-1/2 -translate-x-1/2 z-[200] animate-in slide-in-from-top-4 fade-in duration-200">
      <div className={`
        px-6 py-3 rounded-full shadow-lg font-mono text-sm font-bold tracking-wide
        ${type === 'error' ? 'bg-red-500 text-white' : 'bg-[var(--bg-surface)] text-[var(--brand-secondary)] border-2 border-[var(--brand-secondary)]'}
      `}>
        {message}
      </div>
    </div>
  );
}
```

### Skeleton Loaders (`frontend/src/components/ui/Skeleton.tsx`)
Prevents layout shift before data loads from FastAPI. Uses high-contrast pulsing in Futuristic mode.
```tsx
export function SkeletonListCard() {
  return (
    <div className="w-full h-48 bg-[var(--bg-surface)] rounded-[var(--radius-ui)] p-6 border border-(--border-accent) animate-pulse flex flex-col gap-4">
      <div className="w-3/4 h-8 bg-[var(--bg-base)] rounded-md" />
      <div className="w-1/4 h-4 bg-[var(--bg-base)] rounded-md" />
      <div className="w-full h-full mt-4 bg-[var(--bg-base)] rounded-[calc(var(--radius-ui)-8px)]" />
    </div>
  );
}
```

---

## ğŸ’» Step 6 â€” The Compose Form Architecture

Forms adapt structurally to the Theme.

**Futuristic Compose**
- Heavily structured.
- Rendered as explicit `Card` blocks per list item.
- Inputs are pill-shaped, floating, minimal labels.

**Retro Compose**
- A single, monolithic white box with harsh black borders.
- Labels are bold Serif font.
- Native browser `<input>` and `<textarea>` styling forced via CSS.

---

## ğŸ’» Step 7 â€” Empty Feed Selection

If a user goes to their Connection Feed and follows no one:
1. Render `<EmptyState variant="connection_feed" />`
2. Shows SVG illustration of an empty desert/void.
3. Renders a grid of "Genres" (Tech, Music, Politics, Film).
4. User clicks genres to auto-subscribe and populate the fallback feed feed via `PATCH /api/users/me/preferences`.

---

## ğŸ’» Step 8 â€” Custom Profile Sandbox Architecture (Spacehey Style)

To allow users to write custom CSS securely:

1. Submissions hit backend: `POST /api/users/profile/css`
2. Backend strips `<script>`, `expression()`, and `@import` to prevent XSS.
3. On the frontend `[username]/page.tsx`, the CSS is injected via a scoped style block:

```tsx
<style id="user-custom-css" dangerouslySetInnerHTML={{ __html: `
  .profile-container[data-user="${user.id}"] {
    ${sanitizedUserCSS}
  }
`}} />
```

By prefixing all their selectors strictly under `.profile-container`, we guarantee their custom code cannot overwrite the Topbar or Sidebar, preserving site navigation safety.

For the **Music Player**:
Users submit a Spotify Track ID or YouTube Video ID. The profile page securely renders the official `<iframe>` embed widget restricted to the sidebar.

---

## Validation Checklist

- [ ] `next-themes` installed and `data-theme` switches correctly on body.
- [ ] Changing theme to `retro` instantly flattens the UI and changes fonts to Times New Roman.
- [ ] Clicking Fire ğŸ”¥ drops sparks on the screen via canvas-confetti.
- [ ] Hovering a List Card shows the secondary brand color border (pink).
- [ ] `layout.tsx` is split perfectly into Topbar + Left Sidebar + Main Content.
